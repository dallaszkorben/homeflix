<meta charset="UTF-8" comntent="text/html;charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">

<html>
<head>

    <title>Playem</title>

    <style>

        .thumbnail-section {
            border:3px red solid;
            width: 100%;
/*            overflow: hidden; */
            /*white-space: nowrap;*/
/*            display: flex; */
/*            flex-direction: row; */
/*            flex-wrap: nowrap; */
        }

        .thumbnail-container {
            width: 100%;
            overflow: hidden; 
            /*white-space: nowrap;*/
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: flex-start;
            align-items: flex-start;
            border:3px blue solid;
            box-sizing:border-box;
        }

        .thumbnail {
            width: 400px;
            height: 300;
            margin: 0px;
            border: 3px solid transparent;
            background-color: black;
  
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .thumbnail img {
            /*object-fit: contain;*/
            /*  object-fit: contain;
            /*object-position: center; */
            width: 400px;
            height: auto;
            max-height: 300px;
        }        

#left-arrow,
#right-arrow {
  cursor: pointer;
  font-size: 24px;
  margin-top: 5px;
}

#left-arrow {
  margin-right: 10px;
}
    </style>
    
    <!-- JQuery -->
    <script src="script/jquery/jquery-3.6.0.min.js"></script>
    <script src="script/jquery-ui/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="script/jquery-ui/jquery-ui.css">

    <script>

  $('#right-arrow').click(function() {
    thumbnails.eq(currentIndex).css('border-color', 'transparent');
    currentIndex = (currentIndex + 1) % thumbnails.length;
    thumbnails.eq(currentIndex).css('border-color', 'white');
    scrollThumbnails();
  });

  $('#left-arrow').click(function() {
    thumbnails.eq(currentIndex).css('border-color', 'transparent');
    currentIndex = (currentIndex - 1 + thumbnails.length) % thumbnails.length;
    thumbnails.eq(currentIndex).css('border-color', 'white');
    scrollThumbnails();
  });

    // var sectionMap_1 = 
    // {
    //     "currentContainerIndex": 0,
    //     "id": "section-0",
    //     "class": "thumbnail-section",
    //     "containers": [
    //         {
    //             "currentThumbnailIndex": 0,
    //             "id": "section-0_container-0",
    //             "class": "thumbnail-container"
    //         }
    //     ]
    // }
    String.prototype.format = function () {
        var i = 0, args = arguments;
        return this.replace(/{}/g, function () {
            return typeof args[i] != 'undefined' ? args[i++] : '';
        });
    };

    var attributeMap =
    {
        "section-class": "thumbnail-section",
        "container-class": "thumbnail-container",
        "thumbnail-class": "thumbnail",
        "section-id"     : "section-{}",
        "container-id": "section-{}_container-{}",
        
    }

    var sectionMap_1 = {
            "section-class": attributeMap["section-class"],
            "container-class": attributeMap["container-class"],
            "current-container-index": 0,
            "containers": []
    }

    var defaultCurrentSectionIndex = 0;
    var defaultCurrentContainerIndex = 0;
    var defaultCurrentThumbnailIndex = 0;

    //var sectionMap_1 = 
    // {
    //     "section-class": "thumbnail-section",
    //     "section-id": "section-0",
    //     "container-class": "thumbnail-container",
    //     "current-container-index": 0,
    //     "containers": [
    //         {                    
    //             "container-id": "section-0_container-0",
    //             "thumbnail-class": "thumbnail",
    //             "current-thumbnail-index": 0,
    //         },
    //         {                    
    //             "container-id": "section-0_container-1",
    //             "thumbnail-class": "thumbnail",
    //             "current-thumbnail-index": 0,
    //         },
    //     ]
    // }
    
    // ================================================
    // ================================================
    //
    //  When the page is loaded
    //
    // ================================================
    // ================================================
    $(document).ready(function(){

        // Create thumbnail-section
        var sectionIndex = 0;
        thumbnailSection_1 = $('<div>', {
            id: attributeMap["section-id"].format(sectionIndex),
            class: attributeMap["section-class"],
        })

        sectionMap_1["section-id"] = thumbnailSection_1.attr('id')

        // Place thumbnail-section into the thumbnail section
        $('#thumbnail-sections').append(thumbnailSection_1);

        // Get Standalone DRAMA movies and generate div for them inside #thumbnail-container' div
        $.ajax({type: "GET", url: "/collect/standalone/movies/genre/drama/lang/hu", async: true,
            success: function(result){
//                containerIndex = 0;
//                text = "";
//
//                // Create thumbnail-container
//                 thumbnailContainer = $('<div>', {
//                    class: attributeMap["container-class"],
//                    id: attributeMap["container-id"].format(sectionIndex, containerIndex)
//                })

                text = "";

                newLength = sectionMap_1["containers"].push({});
                containerIndex = newLength - 1;

                // Create thumbnail-container
                thumbnailContainer = $('<div>', {
                    class: attributeMap["container-class"],
                    id: attributeMap["container-id"].format(sectionIndex, containerIndex)
                })

                //sectionMap_1["current-container-index"] = containerIndex;
                sectionMap_1["containers"].push({});
                sectionMap_1["containers"][containerIndex]["container-id"] = thumbnailContainer.attr('id');
                
                sectionMap_1["containers"][containerIndex]["thumbnail-class"] = attributeMap["thumbnail-class"];
                sectionMap_1["containers"][containerIndex]["current-thumbnail-index"] = 0

                for (i in result) {
                    record=result[i];
                    if ( record["title_req"] != null ){
                        //orig_title = "(Original [{1}]: {0})".format(record["title_orig"], record["lang_orig"]) if record["title_orig"] else ""
                        orig_title = "";
                        text += "Id: " + record["id"] + ", Title: " + record["title_req"] + " " + orig_title + "<br>";
                    }else{
                        text += "Id: " + record["id"] + ", Title: (Original [" + record["lang_orig"] + "]) " + record["title_orig"] + "<br>";
                    }

                    // Create image
                    image = $('<img src="' + record["source_path"] + '/image.jpg" alt="Image 1">');
                    
                    // Create thumbnail
                    thumbnail = $("<div>", {
                        class: attributeMap["thumbnail-class"],
                    })
                    //thumbnail = $('<div class="thumbnail">');
                    thumbnail.append(image);                 

                    // mouse event for thumbnail
                    thumbnail.click(function(){
                        selectThumbnail($(this))
                    });

                    // Place thumbnail into thumbnail-container
                    thumbnailContainer.append(thumbnail);
                }               

                // Place thumbnail Container into thumbnail-section
                thumbnailSection_1.append(thumbnailContainer);

                // selection border for the default first thumbnail - it is possible as at least one section container is done
                defaultThumbnailContainerId = sectionMap_1["containers"][defaultCurrentContainerIndex]["container-id"];
                thumbnailClass = attributeMap["thumbnail-class"];
                defaultThumbnails = $("#" + defaultThumbnailContainerId + " ." + thumbnailClass);
                defaultThumbnail = defaultThumbnails.eq(defaultCurrentThumbnailIndex);
                selectThumbnail(defaultThumbnail);
            },
            error: function(xhr,status,error){
                    $("#message").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
//                    $("#spinner").hide();
            }
        })

// ---

        // Get Standalone DRAMA movies and generate div for them inside #thumbnail-container' div
        $.ajax({type: "GET", url: "/collect/standalone/movies/genre/drama/lang/hu", async: true,
            success: function(result){
                
                text = "";

                newLength = sectionMap_1["containers"].push({});
                containerIndex = newLength - 1;

                // Create thumbnail-container
                thumbnailContainer = $('<div>', {
                    class: attributeMap["container-class"],
                    id: attributeMap["container-id"].format(sectionIndex, containerIndex)
                })

                sectionMap_1["containers"][containerIndex]["container-id"] = thumbnailContainer.attr('id');
                
                sectionMap_1["containers"][containerIndex]["thumbnail-class"] = attributeMap["thumbnail-class"];
                sectionMap_1["containers"][containerIndex]["current-thumbnail-index"] = 0

                for (i in result) {
                    record=result[i];
                    if ( record["title_req"] != null ){
                        //orig_title = "(Original [{1}]: {0})".format(record["title_orig"], record["lang_orig"]) if record["title_orig"] else ""
                        orig_title = "";
                        text += "Id: " + record["id"] + ", Title: " + record["title_req"] + " " + orig_title + "<br>";
                    }else{
                        text += "Id: " + record["id"] + ", Title: (Original [" + record["lang_orig"] + "]) " + record["title_orig"] + "<br>";
                    }

                    // Create image
                    image = $('<img src="' + record["source_path"] + '/image.jpg" alt="Image 1">');
                    
                    // Create thumbnail
                    thumbnail = $("<div>", {
                        class: attributeMap["thumbnail-class"],
                    })
                    thumbnail.append(image);                 

                    // mouse event for thumbnail
                    thumbnail.click(function(){
                        selectThumbnail($(this))
                    });

                    // Place thumbnail into thumbnail-container
                    thumbnailContainer.append(thumbnail);
                }               

                // Place thumbnail Container into thumbnail-section
                thumbnailSection_1.append(thumbnailContainer)

                // selection border for the first thumbnail
                defaultThumbnailContainerId = sectionMap_1["containers"][defaultCurrentContainerIndex]["container-id"];
                thumbnailClass = attributeMap["thumbnail-class"];
                defaultThumbnails = $("#" + defaultThumbnailContainerId + " ." + thumbnailClass);
                defaultThumbnail = defaultThumbnails.eq(defaultCurrentThumbnailIndex);
                selectThumbnail(defaultThumbnail);
            },
            error: function(xhr,status,error){
                    $("#message").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
//                    $("#spinner").hide();
            }
        })
     
        function go_right(){
            currentContainerIndex = sectionMap_1["current-container-index"]  
            thumbnailContainerId = sectionMap_1["containers"][currentContainerIndex]["container-id"]

            thumbnailClass = attributeMap["thumbnail-class"]
            currentThumbnailIndex = sectionMap_1["containers"][currentContainerIndex]["current-thumbnail-index"]

            thumbnails = $("#" + thumbnailContainerId + " ." + thumbnailClass)
            thumbnails.eq(currentThumbnailIndex).css('border-color', 'transparent');

            nextThumbnailIndex = (currentThumbnailIndex + 1) % thumbnails.length;
            sectionMap_1["containers"][currentContainerIndex]["current-thumbnail-index"] = nextThumbnailIndex
            thumbnails.eq(nextThumbnailIndex).css('border-color', 'white');

            nextThumbnail = thumbnails.eq(nextThumbnailIndex);
            nextContainer = nextThumbnail.parent();

            scrollThumbnails(nextContainer, nextThumbnailIndex);

        }

        function go_left(){

            currentContainerIndex = sectionMap_1["current-container-index"]  
            thumbnailContainerId = sectionMap_1["containers"][currentContainerIndex]["container-id"]

            thumbnailClass = attributeMap["thumbnail-class"]
            currentThumbnailIndex = sectionMap_1["containers"][currentContainerIndex]["current-thumbnail-index"]

            thumbnails = $("#" + thumbnailContainerId + " ." + thumbnailClass)
            thumbnails.eq(currentThumbnailIndex).css('border-color', 'transparent');

            nextThumbnailIndex = (currentThumbnailIndex - 1 + thumbnails.length) % thumbnails.length;
            sectionMap_1["containers"][currentContainerIndex]["current-thumbnail-index"] = nextThumbnailIndex
            thumbnails.eq(nextThumbnailIndex).css('border-color', 'white');

            nextThumbnail = thumbnails.eq(nextThumbnailIndex);
            nextContainer = nextThumbnail.parent();

            scrollThumbnails(nextContainer, nextThumbnailIndex);
        }

        function go_up(){
            containerClass = attributeMap["container-class"];
            sectionId = sectionMap_1["section-id"];

            currentContainerIndex = sectionMap_1["current-container-index"];

            containers = $("#" + sectionId + " ." + containerClass);

            nextContainerIndex = (currentContainerIndex - 1 + containers.length) % containers.length;

            //

            nextThumbnailContainerId = sectionMap_1["containers"][nextContainerIndex]["container-id"];

            thumbnailClass = attributeMap["thumbnail-class"];
            nextThumbnailIndex = sectionMap_1["containers"][nextContainerIndex]["current-thumbnail-index"];

            nextThumbnails = $("#" + nextThumbnailContainerId + " ." + thumbnailClass);
            nextThumbnail = nextThumbnails.eq(nextThumbnailIndex);
            selectThumbnail(nextThumbnail);
        }

        function go_down(){
            containerClass = attributeMap["container-class"];
            sectionId = sectionMap_1["section-id"];

            currentContainerIndex = sectionMap_1["current-container-index"];

            containers = $("#" + sectionId + " ." + containerClass);

            nextContainerIndex = (currentContainerIndex + 1) % containers.length;
        
            //

            nextThumbnailContainerId = sectionMap_1["containers"][nextContainerIndex]["container-id"];

            thumbnailClass = attributeMap["thumbnail-class"];
            nextThumbnailIndex = sectionMap_1["containers"][nextContainerIndex]["current-thumbnail-index"];

            nextThumbnails = $("#" + nextThumbnailContainerId + " ." + thumbnailClass);
            nextThumbnail = nextThumbnails.eq(nextThumbnailIndex);
            selectThumbnail(nextThumbnail);
        }

        $(document).on('keydown',function(e){
            var act={37:go_left, 38:go_up, 39:go_right, 40:go_down};

            //console.log(e.which)

            if(act[e.which]) 
                var a=new act[e.which];
        });

        /*
        Remove the old selection border
        Show the new selection border
        */
        function selectThumbnail(nextThumbnail){

            nextThumbnailIndex = nextThumbnail.index();

            nextContainer = nextThumbnail.parent();
            nextContainerIndex = nextContainer.index();

            nextSection = nextContainer.parent();
            nextSectionIndex = nextSection.index();

            // Remove selection border from all thumbnail on all containers

            currentContainerIndex = sectionMap_1["current-container-index"]
            sectionMap_1["current-container-index"] = nextContainerIndex
            currentThumbnailContainerId = sectionMap_1["containers"][currentContainerIndex]["container-id"]

            thumbnailClass = attributeMap["thumbnail-class"]
            currentThumbnailIndex = sectionMap_1["containers"][currentContainerIndex]["current-thumbnail-index"]

            currentThumbnails = $("#" + currentThumbnailContainerId + " ." + thumbnailClass)
            currentThumbnails.eq(currentThumbnailIndex).css('border-color', 'transparent');

// ---            

            // put the selector border to the selected thumbnail
            nextThumbnail.css('border-color', 'white');

            // Refresh the thumbnail index
            sectionMap_1["containers"][ nextContainerIndex]["current-thumbnail-index"] = nextThumbnailIndex

            scrollThumbnails(nextContainer, nextThumbnailIndex);


        }

        function scrollThumbnails(container, currentIndex) {
            
            // does not mater which thumbnail
            thumbnails = $('.' + attributeMap["thumbnail-class"]);
            var thumbnailWidth = thumbnails.eq(0).outerWidth(true);
            var containerWidth = container.width();
            var containerScrollLeft = container.scrollLeft();
            var visibleThumbnails = Math.floor(containerWidth / thumbnailWidth);

            if (currentIndex >= visibleThumbnails + containerScrollLeft / thumbnailWidth) {
                container.animate({ scrollLeft: thumbnailWidth * (currentIndex - visibleThumbnails + 1) }, 200);
                console.log(thumbnailWidth * (currentIndex - visibleThumbnails + 1) );
            } else if (currentIndex < containerScrollLeft / thumbnailWidth) {
                container.animate({ scrollLeft: thumbnailWidth * currentIndex }, 200);
                console.log(thumbnailWidth * currentIndex);
            }
        }
    })

</script>

</head>
<body style="background-color:DarkGrey;">

    <div id="message"></div>
    <div id="errormessage"></div>

    <div id="thumbnail-sections"></div>
<!--    <div id="thumbnail-section" class="thumbnail-section"> -->
<!--        <div id="thumbnail-container"> -->
<!--            <div class="thumbnail">
                <img src="images/image3.jpg" alt="Thumbnail 7" />
            </div>
-->            
<!--        </div> -->
<!--    </div> -->
    
<!--<div id="arrow-container">
        <span id="left-arrow">&lt;</span>
        <span id="right-arrow">&gt;</span>
    </div>
-->

</body>
</html>